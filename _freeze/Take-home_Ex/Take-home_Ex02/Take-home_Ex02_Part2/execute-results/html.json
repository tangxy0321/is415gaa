{
  "hash": "c12c8ebeec30a6ee85564ec1a3d2bdb6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-home Exercise 2: Application of Spatial and Spatio-temporal Analysis Methods to Discover the Distribution of Dengue Fever in Tainan City, Taiwan - Report and Analysis\"\nformat: \n  html: \n    code-fold: true\n    code-summary: \"Show the code\"\n    code-overflow: wrap\n    code-line-numbers: true\n    code-copy: hover\nexecute: \n  eval: true\n  echo: true\n  freeze: auto\n---\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, tidyverse, tmap, sfdep, stars)\n```\n:::\n\n\nLoad data in RDS format\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntainan <- read_rds(\"../../data/rds/tainan.rds\")\ndengue <- read_rds(\"../../data/rds/dengue.rds\")\ntainan_dengue <- read_rds(\"../../data/rds/tainan_dengue.rds\")\n```\n:::\n\n\n# Global Spatial Autocorrelation Analysis\n\nThis exercise expected the `sfdep` methods taught in [In-class Exercise 5: Global and Local Measures of Spatial Autocorrelation](\"In-class_Ex/In-class_Ex05/In-class_Ex05.html\") and [In-class Exercise 7: Emerging Hot Spot Analysis](\"In-class_Ex/In-class_Ex07/In-class_Ex07.html\") to derive the various statistic values and explain them.\n\n## Derive contiguity weights with Queen's method\n\n`left_join` to combine the datasets\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntainan_dengue_sf <- left_join(tainan, dengue, \n                              by= join_by(VILLNAME))\n# tainan_dengue_grp_sf <- tainan_dengue_sf %>% \n#   group_by(VILLNAME) %>% \n#   summarise(sum_num_dengue_cases = sum(num_dengue_cases))\n# tainan_dengue_grp_sf\ntainan_dengue_sf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 4500 features and 12 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 120.0627 ymin: 22.89401 xmax: 120.2925 ymax: 23.09144\nGeodetic CRS:  TWD97\nFirst 10 features:\n      VILLCODE COUNTYNAME TOWNNAME      VILLNAME      VILLENG COUNTYID\n1  67000350032     臺南市   安南區 安南區_青草里 Qingcao Vil.        D\n2  67000350032     臺南市   安南區 安南區_青草里 Qingcao Vil.        D\n3  67000350032     臺南市   安南區 安南區_青草里 Qingcao Vil.        D\n4  67000350032     臺南市   安南區 安南區_青草里 Qingcao Vil.        D\n5  67000350032     臺南市   安南區 安南區_青草里 Qingcao Vil.        D\n6  67000350032     臺南市   安南區 安南區_青草里 Qingcao Vil.        D\n7  67000350032     臺南市   安南區 安南區_青草里 Qingcao Vil.        D\n8  67000350032     臺南市   安南區 安南區_青草里 Qingcao Vil.        D\n9  67000350032     臺南市   安南區 安南區_青草里 Qingcao Vil.        D\n10 67000350032     臺南市   安南區 安南區_青草里 Qingcao Vil.        D\n   COUNTYCODE TOWNID TOWNCODE NOTE week num_dengue_cases\n1       67000    D06 67000350 <NA>   37                1\n2       67000    D06 67000350 <NA>   41                1\n3       67000    D06 67000350 <NA>   31                0\n4       67000    D06 67000350 <NA>   32                0\n5       67000    D06 67000350 <NA>   33                0\n6       67000    D06 67000350 <NA>   34                0\n7       67000    D06 67000350 <NA>   35                0\n8       67000    D06 67000350 <NA>   36                0\n9       67000    D06 67000350 <NA>   38                0\n10      67000    D06 67000350 <NA>   39                0\n                         geometry\n1  POLYGON ((120.1176 23.08387...\n2  POLYGON ((120.1176 23.08387...\n3  POLYGON ((120.1176 23.08387...\n4  POLYGON ((120.1176 23.08387...\n5  POLYGON ((120.1176 23.08387...\n6  POLYGON ((120.1176 23.08387...\n7  POLYGON ((120.1176 23.08387...\n8  POLYGON ((120.1176 23.08387...\n9  POLYGON ((120.1176 23.08387...\n10 POLYGON ((120.1176 23.08387...\n```\n\n\n:::\n:::\n\n\nThis would be how the distribution of the dengue dataset\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\ntmap mode set to plotting\n```\n\n\n:::\n\n```{.r .cell-code}\ntm_shape(tainan_dengue_sf %>% \n           group_by(VILLNAME) %>% \n           summarise(cases = sum(num_dengue_cases))) +\n  tm_fill(\"cases\", \n          style = \"quantile\", \n          palette = \"Blues\",\n          title = \"Cases\") +\n  tm_layout(main.title = \"Distribution of Dengue Cases by village, Tainan County\",\n            main.title.position = \"center\",\n            main.title.size = 0.8,\n            legend.height = 0.45, \n            legend.width = 0.35,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", size = 2)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_Part2_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\nGet neighbour list\n\n-   `mutate` create the `nb` and `wt` columns\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue_wm_q <- tainan_dengue_sf %>% \n  mutate(nb = st_contiguity(geometry),\n         wt = st_weights(nb,\n                         style = \"W\"),\n         .before = 1)\ndengue_wm_q\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 4500 features and 14 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 120.0627 ymin: 22.89401 xmax: 120.2925 ymax: 23.09144\nGeodetic CRS:  TWD97\nFirst 10 features:\n                                                                                                                                                                                                                                                                                                                                                                                                                       nb\n1  2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 2341, 2342, 2343, 2344, 2345, 2346, 2347, 2348, 2349, 2350, 2351, 2352, 2353, 2354, 2355, 2356, 2357, 2358, 2359, 2360, 3181, 3182, 3183, 3184, 3185, 3186, 3187, 3188, 3189, 3190, 3191, 3192, 3193, 3194, 3195, 3196, 3197, 3198, 3199, 3200\n2  1, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 2341, 2342, 2343, 2344, 2345, 2346, 2347, 2348, 2349, 2350, 2351, 2352, 2353, 2354, 2355, 2356, 2357, 2358, 2359, 2360, 3181, 3182, 3183, 3184, 3185, 3186, 3187, 3188, 3189, 3190, 3191, 3192, 3193, 3194, 3195, 3196, 3197, 3198, 3199, 3200\n3  1, 2, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 2341, 2342, 2343, 2344, 2345, 2346, 2347, 2348, 2349, 2350, 2351, 2352, 2353, 2354, 2355, 2356, 2357, 2358, 2359, 2360, 3181, 3182, 3183, 3184, 3185, 3186, 3187, 3188, 3189, 3190, 3191, 3192, 3193, 3194, 3195, 3196, 3197, 3198, 3199, 3200\n4  1, 2, 3, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 2341, 2342, 2343, 2344, 2345, 2346, 2347, 2348, 2349, 2350, 2351, 2352, 2353, 2354, 2355, 2356, 2357, 2358, 2359, 2360, 3181, 3182, 3183, 3184, 3185, 3186, 3187, 3188, 3189, 3190, 3191, 3192, 3193, 3194, 3195, 3196, 3197, 3198, 3199, 3200\n5  1, 2, 3, 4, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 2341, 2342, 2343, 2344, 2345, 2346, 2347, 2348, 2349, 2350, 2351, 2352, 2353, 2354, 2355, 2356, 2357, 2358, 2359, 2360, 3181, 3182, 3183, 3184, 3185, 3186, 3187, 3188, 3189, 3190, 3191, 3192, 3193, 3194, 3195, 3196, 3197, 3198, 3199, 3200\n6  1, 2, 3, 4, 5, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 2341, 2342, 2343, 2344, 2345, 2346, 2347, 2348, 2349, 2350, 2351, 2352, 2353, 2354, 2355, 2356, 2357, 2358, 2359, 2360, 3181, 3182, 3183, 3184, 3185, 3186, 3187, 3188, 3189, 3190, 3191, 3192, 3193, 3194, 3195, 3196, 3197, 3198, 3199, 3200\n7  1, 2, 3, 4, 5, 6, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 2341, 2342, 2343, 2344, 2345, 2346, 2347, 2348, 2349, 2350, 2351, 2352, 2353, 2354, 2355, 2356, 2357, 2358, 2359, 2360, 3181, 3182, 3183, 3184, 3185, 3186, 3187, 3188, 3189, 3190, 3191, 3192, 3193, 3194, 3195, 3196, 3197, 3198, 3199, 3200\n8  1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 2341, 2342, 2343, 2344, 2345, 2346, 2347, 2348, 2349, 2350, 2351, 2352, 2353, 2354, 2355, 2356, 2357, 2358, 2359, 2360, 3181, 3182, 3183, 3184, 3185, 3186, 3187, 3188, 3189, 3190, 3191, 3192, 3193, 3194, 3195, 3196, 3197, 3198, 3199, 3200\n9  1, 2, 3, 4, 5, 6, 7, 8, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 2341, 2342, 2343, 2344, 2345, 2346, 2347, 2348, 2349, 2350, 2351, 2352, 2353, 2354, 2355, 2356, 2357, 2358, 2359, 2360, 3181, 3182, 3183, 3184, 3185, 3186, 3187, 3188, 3189, 3190, 3191, 3192, 3193, 3194, 3195, 3196, 3197, 3198, 3199, 3200\n10  1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 2341, 2342, 2343, 2344, 2345, 2346, 2347, 2348, 2349, 2350, 2351, 2352, 2353, 2354, 2355, 2356, 2357, 2358, 2359, 2360, 3181, 3182, 3183, 3184, 3185, 3186, 3187, 3188, 3189, 3190, 3191, 3192, 3193, 3194, 3195, 3196, 3197, 3198, 3199, 3200\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   wt\n1  0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823\n2  0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823\n3  0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823\n4  0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823\n5  0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823\n6  0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823\n7  0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823\n8  0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823\n9  0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823\n10 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.01265823\n      VILLCODE COUNTYNAME TOWNNAME      VILLNAME      VILLENG COUNTYID\n1  67000350032     臺南市   安南區 安南區_青草里 Qingcao Vil.        D\n2  67000350032     臺南市   安南區 安南區_青草里 Qingcao Vil.        D\n3  67000350032     臺南市   安南區 安南區_青草里 Qingcao Vil.        D\n4  67000350032     臺南市   安南區 安南區_青草里 Qingcao Vil.        D\n5  67000350032     臺南市   安南區 安南區_青草里 Qingcao Vil.        D\n6  67000350032     臺南市   安南區 安南區_青草里 Qingcao Vil.        D\n7  67000350032     臺南市   安南區 安南區_青草里 Qingcao Vil.        D\n8  67000350032     臺南市   安南區 安南區_青草里 Qingcao Vil.        D\n9  67000350032     臺南市   安南區 安南區_青草里 Qingcao Vil.        D\n10 67000350032     臺南市   安南區 安南區_青草里 Qingcao Vil.        D\n   COUNTYCODE TOWNID TOWNCODE NOTE week num_dengue_cases\n1       67000    D06 67000350 <NA>   37                1\n2       67000    D06 67000350 <NA>   41                1\n3       67000    D06 67000350 <NA>   31                0\n4       67000    D06 67000350 <NA>   32                0\n5       67000    D06 67000350 <NA>   33                0\n6       67000    D06 67000350 <NA>   34                0\n7       67000    D06 67000350 <NA>   35                0\n8       67000    D06 67000350 <NA>   36                0\n9       67000    D06 67000350 <NA>   38                0\n10      67000    D06 67000350 <NA>   39                0\n                         geometry\n1  POLYGON ((120.1176 23.08387...\n2  POLYGON ((120.1176 23.08387...\n3  POLYGON ((120.1176 23.08387...\n4  POLYGON ((120.1176 23.08387...\n5  POLYGON ((120.1176 23.08387...\n6  POLYGON ((120.1176 23.08387...\n7  POLYGON ((120.1176 23.08387...\n8  POLYGON ((120.1176 23.08387...\n9  POLYGON ((120.1176 23.08387...\n10 POLYGON ((120.1176 23.08387...\n```\n\n\n:::\n:::\n\n\nGet Global Moran I statistics\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1004)\nglobal_m_perm = global_moran_perm(dengue_wm_q$num_dengue_cases, \n                  dengue_wm_q$nb,\n                  dengue_wm_q$wt,\n                  nsim = 99)\nglobal_m_perm\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 100 \n\nstatistic = 0.15585, observed rank = 100, p-value < 2.2e-16\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\nThe report above shows that the p-value is less than the alpha value of 0.05. We have sufficient statistical evidence to reject the null hypothesis that spatial distribution of dengue cases is random. Also as the Moran I statistics is greater than 0, the spatial distribution of dengue cases had shown sign of clustering.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(global_m_perm$res,\n     freq = TRUE,\n     breaks = 20,\n     xlab = \"Simulated Moran's I\")\nabline(v = 0,\n       col = \"red\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_Part2_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n# Local Spatial Autocorrelation Analysis\n\n## Cluster and Outlier Analysis\n\nGet local Moran's I statistics to \n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1003)\nlisa <- dengue_wm_q %>% \n  mutate(local_moran = local_moran(num_dengue_cases, nb, wt,\n                                   nsim = 199),\n         .before = 1) %>% \n  unnest(local_moran)\nglimpse(lisa)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 4,500\nColumns: 27\n$ ii               <dbl> 0.29488831, 0.29488831, 0.40429780, 0.40429780, 0.404…\n$ eii              <dbl> 5.545713e-03, -3.955986e-03, -1.712331e-03, 2.552024e…\n$ var_ii           <dbl> 0.0027765888, 0.0031276437, 0.0055156977, 0.006768213…\n$ z_ii             <dbl> 5.491065, 5.343630, 5.466843, 4.914020, 5.175360, 6.0…\n$ p_ii             <dbl> 3.995169e-08, 9.110368e-08, 4.581202e-08, 8.922757e-0…\n$ p_ii_sim         <dbl> 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01,…\n$ p_folded_sim     <dbl> 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.00…\n$ skewness         <dbl> -0.19315267, -0.51281160, -0.26268657, -0.40516291, -…\n$ kurtosis         <dbl> 0.049194460, 0.330521763, 0.704702906, 0.079090693, 0…\n$ mean             <fct> Low-Low, Low-Low, Low-Low, Low-Low, Low-Low, Low-Low,…\n$ median           <fct> Low-Low, Low-Low, Low-Low, Low-Low, Low-Low, Low-Low,…\n$ pysal            <fct> Low-Low, Low-Low, Low-Low, Low-Low, Low-Low, Low-Low,…\n$ nb               <nb> <2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 1…\n$ wt               <list> <0.01265823, 0.01265823, 0.01265823, 0.01265823, 0.0…\n$ VILLCODE         <chr> \"67000350032\", \"67000350032\", \"67000350032\", \"6700035…\n$ COUNTYNAME       <chr> \"臺南市\", \"臺南市\", \"臺南市\", \"臺南市\", \"臺南市\", \"臺…\n$ TOWNNAME         <chr> \"安南區\", \"安南區\", \"安南區\", \"安南區\", \"安南區\", \"安…\n$ VILLNAME         <chr> \"安南區_青草里\", \"安南區_青草里\", \"安南區_青草里\", \"…\n$ VILLENG          <chr> \"Qingcao Vil.\", \"Qingcao Vil.\", \"Qingcao Vil.\", \"Qing…\n$ COUNTYID         <chr> \"D\", \"D\", \"D\", \"D\", \"D\", \"D\", \"D\", \"D\", \"D\", \"D\", \"D\"…\n$ COUNTYCODE       <chr> \"67000\", \"67000\", \"67000\", \"67000\", \"67000\", \"67000\",…\n$ TOWNID           <chr> \"D06\", \"D06\", \"D06\", \"D06\", \"D06\", \"D06\", \"D06\", \"D06…\n$ TOWNCODE         <chr> \"67000350\", \"67000350\", \"67000350\", \"67000350\", \"6700…\n$ NOTE             <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…\n$ week             <dbl> 37, 41, 31, 32, 33, 34, 35, 36, 38, 39, 40, 42, 43, 4…\n$ num_dengue_cases <int> 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ geometry         <POLYGON [°]> POLYGON ((120.1176 23.08387..., POLYGON ((120…\n```\n\n\n:::\n:::\n\n\nLook at the local Moran I statistics for each village. The graph supports our interpretation that the data is clustered.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\ntmap mode set to plotting\n```\n\n\n:::\n\n```{.r .cell-code}\nmap1 <- tm_shape(lisa) +\n  tm_fill(col = \"p_ii\",\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"),\n          palette = \"-YlOrBr\",\n          title = \"p-values\") +\n  tm_borders(alpha = 0.5) +\n  tm_layout(main.title = \"p-value of local Moran's I\",\n            main.title.size = 0.8)\n\nmap2 <- tm_shape(lisa) +\n  tm_fill(\"ii\") + \n  tm_borders(alpha = 0.5) +\n  tm_view(set.zoom.limits = c(6,8)) +\n  tm_layout(main.title = \"local Moran's I of GDPPC\",\n            main.title.size = 0.8)\n\ntmap_arrange(map1,map2,ncol = 2)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nVariable(s) \"ii\" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-home_Ex02_Part2_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nWe can see that both negative and positive local Moran's I statistics values exist in the dataset.\n\nWe now want to look at the local Moran's I statistics for statistically important villages (where the p-value < 0.05).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\") +\n  tm_shape(lisa %>% \n             relocate(VILLNAME,\n                      .before = 1) %>% \n             filter(p_ii < 0.05)) +\n  tm_fill(\"ii\") +\n  tm_borders(alpha = 0.5) +\n  # tm_view(set.zoom.limits = c(6,8)) +\n  tm_layout(main.title = \"p-values for Number of dengue cases in each village\",\n            main.title.size = 0.8)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\ntmap mode set to plotting\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nVariable(s) \"ii\" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-home_Ex02_Part2_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nFrom the above we can see that, the outlier exist around the centre of the Tainan county and the cluster lies nearer to the boundary of the Tainan county.\n\n# Emerging Hotspot Analysis\n\nNow we want to know where are the hot and cold spots.\n\nMaking use of the spacetime layer derived in [Part 1](Take-home_Ex/Take-home_Ex02/Take-home_Ex02_Part1.html), we calculate the contiguity weight matrix. \n\nBefore starting work, we need to ensure that the layer is indeed a spacetime cube object.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nis_spacetime_cube(tainan_dengue)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue_nb <- tainan_dengue %>%\n  activate(\"geometry\") %>%\n  mutate(nb = include_self(st_contiguity(geometry)),\n         wt = st_inverse_distance(nb, geometry,\n                                  scale = 1,\n                                  alpha = 1),\n         .before = 1) %>% \n  set_nbs(\"nb\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n! Polygon provided. Using point on surface.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: There was 1 warning in `stopifnot()`.\nℹ In argument: `wt = st_inverse_distance(nb, geometry, scale = 1, alpha = 1)`.\nCaused by warning in `st_point_on_surface.sfc()`:\n! st_point_on_surface may not give correct results for longitude/latitude data\n```\n\n\n:::\n\n```{.r .cell-code}\n  # set_wts(\"wt\")\n\nis_spacetime_cube(dengue_nb)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] FALSE\n```\n\n\n:::\n:::\n\nStart computing the local Gi* for each village\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# gi_stars <- dengue_nb %>% \n#   group_by(week) %>% \n#   mutate(gi_stars = local_gstar_perm(num_dengue_cases, nb , wt,\n#                                      nsim = 99)) %>%\n#   unnest(gi_stars)\n```\n:::\n",
    "supporting": [
      "Take-home_Ex02_Part2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}