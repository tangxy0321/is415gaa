{
  "hash": "08e00aa48b8b9df184446bc0876ad1a9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-home Exercise 1: Application of Spatial Point Pattern Analysis on Grab Hailing Service in Singapore\"\nformat: \n  html: \n    code-fold: true\n    code-summary: \"Show the code\"\n    code-overflow: wrap\n    code-line-numbers: true\n    code-copy: hover\n    self-contained: true\nexecute: \n  eval: true\n  echo: true\n  freeze: auto\nauthor: \"Tang Xin Yi\"\ndate: \"17 Jan 2024\"\n---\n\n\n# 1 Problem context\n\nThis exercise is looking into discovering insights relevant to the geographical and spatial distribution of Grab hailing service locations in Singapore.\n\nIn this exercise, the following packages are used.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, tidyverse, tmap, spatstat, raster, maptools, spNetwork, classInt, viridis, arrow, lubridate)\n```\n:::\n\n\n# 2 Data\n\n## 2.1 Background of the datasets used\n\nThe following datasets are used in this analysis exercise.\n\n-   `GrabPosisi`: Aspatial data\n\n-   `RoadMap`: from OpenStreetMap\n\n-   `Master Plan 2019 Subzone Boundary (No Sea)` from Data.gov.sg\n\n## 2.2 Import data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrab <- read_parquet(\"../../data/aspatial/GrabPosisi/part-00000-8bbff892-97d2-4011-9961-703e38972569.c000.snappy.parquet\")\n\nroadmap <- st_read(dsn = \"../../data/geospatial/malaysia-singapore-brunei-latest-free.shp\",\n                   layer = \"gis_osm_roads_free_1\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `gis_osm_roads_free_1' from data source \n  `/Users/tangtang/Desktop/IS415 Geospatial Analytics and Applications/practice/is415gaa/data/geospatial/malaysia-singapore-brunei-latest-free.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 1759836 features and 10 fields\nGeometry type: LINESTRING\nDimension:     XY\nBounding box:  xmin: 99.66041 ymin: 0.8021131 xmax: 119.2601 ymax: 7.514393\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\nmp19 <- st_read(\"../../data/geospatial/MasterPlan2019SubzoneBoundaryNoSeaKML.kml\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `URA_MP19_SUBZONE_NO_SEA_PL' from data source \n  `/Users/tangtang/Desktop/IS415 Geospatial Analytics and Applications/practice/is415gaa/data/geospatial/MasterPlan2019SubzoneBoundaryNoSeaKML.kml' \n  using driver `KML'\nSimple feature collection with 332 features and 2 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY, XYZ\nBounding box:  xmin: 103.6057 ymin: 1.158699 xmax: 104.0885 ymax: 1.470775\nz_range:       zmin: 0 zmax: 0\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n\nFrom below, `grab$pingtimestamp` is not in the correct data type (it is in int class)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(grab)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 9\n  trj_id driving_mode osname  pingtimestamp rawlat rawlng speed bearing accuracy\n  <chr>  <chr>        <chr>           <int>  <dbl>  <dbl> <dbl>   <int>    <dbl>\n1 70014  car          android    1554943236   1.34   104.  18.9     248      3.9\n2 73573  car          android    1555582623   1.32   104.  17.7      44      4  \n3 75567  car          android    1555141026   1.33   104.  14.0      34      3.9\n4 1410   car          android    1555731693   1.26   104.  13.0     181      4  \n5 4354   car          android    1555584497   1.28   104.  14.8      93      3.9\n6 32630  car          android    1555395258   1.30   104.  23.2      73      3.9\n```\n\n\n:::\n\n```{.r .cell-code}\ngrab$pingtimestamp = as_datetime(grab$pingtimestamp)\n```\n:::\n\n\nNow the `pingtimestamp` is in the correct data type `POSIXct` which represents datetime in tibble\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(grab)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 9\n  trj_id driving_mode osname  pingtimestamp       rawlat rawlng speed bearing\n  <chr>  <chr>        <chr>   <dttm>               <dbl>  <dbl> <dbl>   <int>\n1 70014  car          android 2019-04-11 00:40:36   1.34   104.  18.9     248\n2 73573  car          android 2019-04-18 10:17:03   1.32   104.  17.7      44\n3 75567  car          android 2019-04-13 07:37:06   1.33   104.  14.0      34\n4 1410   car          android 2019-04-20 03:41:33   1.26   104.  13.0     181\n5 4354   car          android 2019-04-18 10:48:17   1.28   104.  14.8      93\n6 32630  car          android 2019-04-16 06:14:18   1.30   104.  23.2      73\n# ℹ 1 more variable: accuracy <dbl>\n```\n\n\n:::\n:::\n\n\nThere are Z dimensions in `mp19` multipolygon Z, drop Z dimensions to keep the multipolygons\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmp19 <- st_zm(mp19$geometry, drop = TRUE, what = \"ZM\")\n```\n:::\n\n\nThe tibble data.frame is using coordinate system `WGS 84`, but we want to use the data in `SVY21`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_crs(mp19)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System:\n  User input: WGS 84 \n  wkt:\nGEOGCRS[\"WGS 84\",\n    DATUM[\"World Geodetic System 1984\",\n        ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n            LENGTHUNIT[\"metre\",1]]],\n    PRIMEM[\"Greenwich\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\n    CS[ellipsoidal,2],\n        AXIS[\"geodetic latitude (Lat)\",north,\n            ORDER[1],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        AXIS[\"geodetic longitude (Lon)\",east,\n            ORDER[2],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n    ID[\"EPSG\",4326]]\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmp19 <- st_transform(mp19, crs = 3414)\nhead(mp19)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nGeometry set for 6 features \nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 24431.8 ymin: 28515.07 xmax: 30213.96 ymax: 29882\nProjected CRS: SVY21 / Singapore TM\nFirst 5 geometries:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nMULTIPOLYGON (((25910.34 29425.34, 26265.82 292...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nMULTIPOLYGON (((26750.09 29216.1, 26751.91 2917...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nMULTIPOLYGON (((29161.2 29723.07, 29189.03 2970...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nMULTIPOLYGON (((29814.11 29616.89, 29806.68 295...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nMULTIPOLYGON (((30137.77 29843.19, 30138.42 298...\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(roadmap)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 6 features and 10 fields\nGeometry type: LINESTRING\nDimension:     XY\nBounding box:  xmin: 101.7033 ymin: 1.305992 xmax: 103.8301 ymax: 3.147986\nGeodetic CRS:  WGS 84\n   osm_id code      fclass                   name  ref oneway maxspeed layer\n1 4386520 5113     primary           Orchard Road <NA>      F       50     0\n2 4578273 5114   secondary    Jalan Bukit Bintang <NA>      F        0     0\n3 4579495 5122 residential         Jalan Nagasari <NA>      B        0     0\n4 4579533 5122 residential  Persiaran Raja Chulan <NA>      B        0     0\n5 4579534 5122 residential           Jalan Ceylon <NA>      B        0     0\n6 4579536 5122 residential Changkat Bukit Bintang <NA>      F        0     0\n  bridge tunnel                       geometry\n1      F      F LINESTRING (103.8301 1.3060...\n2      F      F LINESTRING (101.7226 3.1478...\n3      F      F LINESTRING (101.7084 3.1473...\n4      F      F LINESTRING (101.7043 3.1468...\n5      F      F LINESTRING (101.7033 3.1476...\n6      F      F LINESTRING (101.7088 3.1470...\n```\n\n\n:::\n\n```{.r .cell-code}\nst_crs(roadmap)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System:\n  User input: WGS 84 \n  wkt:\nGEOGCRS[\"WGS 84\",\n    DATUM[\"World Geodetic System 1984\",\n        ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n            LENGTHUNIT[\"metre\",1]]],\n    PRIMEM[\"Greenwich\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\n    CS[ellipsoidal,2],\n        AXIS[\"latitude\",north,\n            ORDER[1],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        AXIS[\"longitude\",east,\n            ORDER[2],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n    ID[\"EPSG\",4326]]\n```\n\n\n:::\n:::\n\n\n`roadmap` has a similar problem as `mp19`, the coordinate system needs to be changed to `SVY 21`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nroadmap <- st_transform(roadmap, crs = 3414)\nhead(roadmap)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 6 features and 10 fields\nGeometry type: LINESTRING\nDimension:     XY\nBounding box:  xmin: -208807.5 ymin: 32035.45 xmax: 27643.1 ymax: 235953.4\nProjected CRS: SVY21 / Singapore TM\n   osm_id code      fclass                   name  ref oneway maxspeed layer\n1 4386520 5113     primary           Orchard Road <NA>      F       50     0\n2 4578273 5114   secondary    Jalan Bukit Bintang <NA>      F        0     0\n3 4579495 5122 residential         Jalan Nagasari <NA>      B        0     0\n4 4579533 5122 residential  Persiaran Raja Chulan <NA>      B        0     0\n5 4579534 5122 residential           Jalan Ceylon <NA>      B        0     0\n6 4579536 5122 residential Changkat Bukit Bintang <NA>      F        0     0\n  bridge tunnel                       geometry\n1      F      F LINESTRING (27637.52 32038....\n2      F      F LINESTRING (-206660 235943....\n3      F      F LINESTRING (-208246.4 23589...\n4      F      F LINESTRING (-208704.9 23583...\n5      F      F LINESTRING (-208807.5 23591...\n6      F      F LINESTRING (-208200.4 23585...\n```\n\n\n:::\n:::\n\n\n## 2.3 Prepare required Geographical data layers\n\nThis exercise needs the following geographical data layers\n\n1.  Grab taxi location points either by origins or destinations\n\n2.  Road layer within Singapore excluding outer islands\n\n3.  Singapore boundary layer excluding outer islands\n\n### 2.3.1 Get Grab taxi origin and destination layer\n\nGet the origin tibble data.frame\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrip_origin <- grab %>% \n  # group by trip id\n  group_by(trj_id) %>% \n  # sort: ascending by default\n  arrange(pingtimestamp, .by_group = FALSE) %>% \n  # get 1st row\n  filter(row_number()==1) %>% \n  mutate(weekday = wday(pingtimestamp,\n                        label = TRUE,\n                        abbr = TRUE),\n         start_hr = factor(hour(pingtimestamp)),\n         day = factor(mday(pingtimestamp)))\n```\n:::\n\n\n\n\n\nGet the destination tibble data.frame\n\nConverting `rawlat` and `rawlng` with formula provided in this [StackOverflow tread](https://stackoverflow.com/questions/1185408/converting-from-longitude-latitude-to-cartesian-coordinates)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrip_dest <- grab %>% \n  group_by(trj_id) %>% \n  arrange(desc(pingtimestamp), .by_group = FALSE) %>% \n  filter(row_number()==1) %>% \n  mutate(weekday = wday(pingtimestamp,\n                        label = TRUE,\n                        abbr = TRUE),\n         end_hr = factor(hour(pingtimestamp)),\n         day = factor(mday(pingtimestamp)))\n```\n:::\n\n\nThe extracted data layers are written into `rds` files for easier reference later.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(trip_origin, \"../../data/rds/trip_origin.rds\")\nwrite_rds(trip_dest, \"../../data/rds/trip_dest.rds\")\n```\n:::\n\n\n### 2.3.3 Get Singapore boundary layer\n\nThis part is using `mp19` and `roadmap`\n\nDo a quick plot of the union to get the boundary layer\n\nUse of `subset()` function credited to `Anonymous Calc` from [Piazza](https://piazza.com/class/lqua3egki6w3oi/post/48)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlengths(mp19)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 6 1 1 1 1 1 1 1 1 1 1 1 8 4 9 8 1 1 1 1 1 1\n [38] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1\n [75] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1\n[112] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1\n[149] 1 1 1 1 1 1 1 1 1 1 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1\n[186] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1\n[223] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1\n[260] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1\n[297] 1 1 1 1 1 2 1 1 1 1 3 1 1 1 1 1 1 1 1 1 1 4 1 1 1 1 1 1 1 1 1 1 1 1 1 3\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmp19main <- subset(mp19, lengths(mp19) <= 3 )\nplot(st_union(mp19main))\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsummary(mp19main)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n MULTIPOLYGON     epsg:3414 +proj=tmer... \n          325             0             0 \n```\n\n\n:::\n:::\n\n\nSave the boundary layer into RDS file\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(st_union(mp19main), \"../../data/rds/sg_bount.rds\")\n```\n:::\n\n\n### 2.3.2 Get Road layer within Singapore\n\nOverlap the 2 dataframe to get only roads for Singapore\n\n\n::: {.cell}\n\n```{.r .cell-code}\nroad_sg <- st_intersection(roadmap, mp19main)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: attribute variables are assumed to be spatially constant throughout\nall geometries\n```\n\n\n:::\n:::\n\n\nZoom in to see the roads via ID\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\ntmap mode set to plotting\n```\n\n\n:::\n\n```{.r .cell-code}\ntm_shape(road_sg)+\n  tm_lines()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\nExtract out the road layer\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(road_sg, \"../../data/rds/road_sg.rds\")\n```\n:::\n\n\n# 3 Kernel Density Estimation\n\nFrom here on, the rds files would be used instead of the original data files.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nroad <- read_rds(\"../../data/rds/road_sg.rds\")\nsg_boun <- read_rds(\"../../data/rds/sg_bount.rds\")\ntrip_origin <- read_rds(\"../../data/rds/trip_origin.rds\")\ntrip_dest <- read_rds(\"../../data/rds/trip_dest.rds\")\n\nst_crs(sg_boun)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System:\n  User input: EPSG:3414 \n  wkt:\nPROJCRS[\"SVY21 / Singapore TM\",\n    BASEGEOGCRS[\"SVY21\",\n        DATUM[\"SVY21\",\n            ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n                LENGTHUNIT[\"metre\",1]]],\n        PRIMEM[\"Greenwich\",0,\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        ID[\"EPSG\",4757]],\n    CONVERSION[\"Singapore Transverse Mercator\",\n        METHOD[\"Transverse Mercator\",\n            ID[\"EPSG\",9807]],\n        PARAMETER[\"Latitude of natural origin\",1.36666666666667,\n            ANGLEUNIT[\"degree\",0.0174532925199433],\n            ID[\"EPSG\",8801]],\n        PARAMETER[\"Longitude of natural origin\",103.833333333333,\n            ANGLEUNIT[\"degree\",0.0174532925199433],\n            ID[\"EPSG\",8802]],\n        PARAMETER[\"Scale factor at natural origin\",1,\n            SCALEUNIT[\"unity\",1],\n            ID[\"EPSG\",8805]],\n        PARAMETER[\"False easting\",28001.642,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8806]],\n        PARAMETER[\"False northing\",38744.572,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8807]]],\n    CS[Cartesian,2],\n        AXIS[\"northing (N)\",north,\n            ORDER[1],\n            LENGTHUNIT[\"metre\",1]],\n        AXIS[\"easting (E)\",east,\n            ORDER[2],\n            LENGTHUNIT[\"metre\",1]],\n    USAGE[\n        SCOPE[\"Cadastre, engineering survey, topographic mapping.\"],\n        AREA[\"Singapore - onshore and offshore.\"],\n        BBOX[1.13,103.59,1.47,104.07]],\n    ID[\"EPSG\",3414]]\n```\n\n\n:::\n\n```{.r .cell-code}\nst_crs(trip_origin)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System: NA\n```\n\n\n:::\n\n```{.r .cell-code}\nst_crs(trip_dest)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System: NA\n```\n\n\n:::\n:::\n\n\nAccording to the steps in In-class Exercises 3, the tibble needs to be wrangled.\n\n## 3.1 Geospatial data wrangling\n\n`sf` is preferred, convert to `sf`\n\nUpon investigation, the window size of the `trip_origin` and `sg_boun` differs too much.\n\nWith reference to this [page](https://rstudio-pubs-static.s3.amazonaws.com/19879_7e13ab80d5ed416c8e235bd6bb93cf3e.html), the lat-long values are converted into SVY21 XY coordinates. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass(trip_origin)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"grouped_df\" \"tbl_df\"     \"tbl\"        \"data.frame\"\n```\n\n\n:::\n\n```{.r .cell-code}\nclass(trip_dest)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"grouped_df\" \"tbl_df\"     \"tbl\"        \"data.frame\"\n```\n\n\n:::\n\n```{.r .cell-code}\nclass(sg_boun)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"sfc_MULTIPOLYGON\" \"sfc\"             \n```\n\n\n:::\n\n```{.r .cell-code}\n# setting existing coordinate as lat-long system\ntrip_origin_sp_dec <- SpatialPoints(coords = cbind(trip_origin$rawlng, trip_origin$rawlat),\n                                    proj4string = CRS(\"+proj=longlat\"))\ntrip_origin_sp_svy <- spTransform(trip_origin_sp_dec,\n                                  CRS(\"+init=epsg:3414\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in CPL_crs_from_input(x): GDAL Message 1: +init=epsg:XXXX syntax is\ndeprecated. It might return a CRS with a non-EPSG compliant axis order.\n```\n\n\n:::\n\n```{.r .cell-code}\ntrip_dest_sp_dec <- SpatialPoints(coords = cbind(trip_dest$rawlng, trip_dest$rawlat), \n                                  proj4string = CRS(\"+proj=longlat\"))\ntrip_dest_sp_svy <- spTransform(trip_dest_sp_dec,\n                                CRS(\"+init=epsg:3414\"))\n```\n:::\n\nCreate `ppp` object from the `sf` objects\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrip_origin_ppp <- as(trip_origin_sp_svy, \"ppp\")\nsummary(trip_origin_ppp)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPlanar point pattern:  28000 points\nAverage intensity 2.47621e-05 points per square unit\n\nCoordinates are given to 3 decimal places\ni.e. rounded to the nearest multiple of 0.001 units\n\nWindow: rectangle = [3661.47, 49845.23] x [25201.14, 49685.08] units\n                    (46180 x 24480 units)\nWindow area = 1130760000 square units\n```\n\n\n:::\n\n```{.r .cell-code}\ntrip_dest_ppp <- as(trip_dest_sp_svy,\"ppp\")\nsummary(trip_dest_ppp)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPlanar point pattern:  28000 points\nAverage intensity 2.502667e-05 points per square unit\n\nCoordinates are given to 3 decimal places\ni.e. rounded to the nearest multiple of 0.001 units\n\nWindow: rectangle = [3638.69, 50024.92] x [25350.05, 49469.41] units\n                    (46390 x 24120 units)\nWindow area = 1118810000 square units\n```\n\n\n:::\n:::\n\nCheck na values\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum(is.na(trip_origin_ppp))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0\n```\n\n\n:::\n\n```{.r .cell-code}\nsum(is.na(trip_dest_ppp))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0\n```\n\n\n:::\n:::\n\n\nHandle duplicated datapoints\n\n\n::: {.cell}\n\n```{.r .cell-code}\nany(duplicated(trip_origin_ppp))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] FALSE\n```\n\n\n:::\n\n```{.r .cell-code}\nany(duplicated(trip_dest_ppp))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] FALSE\n```\n\n\n:::\n:::\n\n\nCount the number of co-incidence points\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum(multiplicity(trip_origin_ppp) > 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0\n```\n\n\n:::\n\n```{.r .cell-code}\nsum(multiplicity(trip_dest_ppp) > 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0\n```\n\n\n:::\n:::\n\n\nConverting `sg_boun` into `owin` object\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsg_owin <- as.owin(sg_boun)\nplot(sg_owin)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsummary(sg_owin)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nWindow: polygonal boundary\n35 separate polygons (29 holes)\n                  vertices         area relative.area\npolygon 1            12396  6.61065e+08      9.98e-01\npolygon 2              285  1.61128e+06      2.43e-03\npolygon 3               27  1.50315e+04      2.27e-05\npolygon 4 (hole)        41 -4.01660e+04     -6.06e-05\npolygon 5 (hole)       317 -5.11280e+04     -7.72e-05\npolygon 6 (hole)         3 -4.14100e-04     -6.25e-13\npolygon 7               30  2.80002e+04      4.23e-05\npolygon 8 (hole)         4 -2.86396e-01     -4.32e-10\npolygon 9 (hole)         3 -1.81439e-04     -2.74e-13\npolygon 10 (hole)        3 -8.68789e-04     -1.31e-12\npolygon 11 (hole)        3 -5.99531e-04     -9.05e-13\npolygon 12 (hole)        3 -3.04560e-04     -4.60e-13\npolygon 13 (hole)        3 -4.46108e-04     -6.73e-13\npolygon 14 (hole)        3 -3.39815e-04     -5.13e-13\npolygon 15 (hole)        3 -4.52041e-05     -6.82e-14\npolygon 16 (hole)        3 -3.90173e-05     -5.89e-14\npolygon 17 (hole)        3 -9.59845e-05     -1.45e-13\npolygon 18 (hole)        4 -2.54488e-04     -3.84e-13\npolygon 19 (hole)        4 -4.28453e-01     -6.47e-10\npolygon 20 (hole)        4 -2.18619e-04     -3.30e-13\npolygon 21 (hole)        5 -2.44408e-04     -3.69e-13\npolygon 22 (hole)        5 -3.64686e-02     -5.50e-11\npolygon 23 (hole)        6 -8.37554e-01     -1.26e-09\npolygon 24 (hole)       38 -7.79904e+03     -1.18e-05\npolygon 25 (hole)        3 -3.41897e-05     -5.16e-14\npolygon 26 (hole)        3 -3.65499e-03     -5.52e-12\npolygon 27 (hole)        3 -4.95057e-02     -7.47e-11\npolygon 28 (hole)        5 -2.92235e-04     -4.41e-13\npolygon 29 (hole)        3 -7.43615e-06     -1.12e-14\npolygon 30 (hole)      270 -1.21455e+03     -1.83e-06\npolygon 31 (hole)       19 -4.39650e+00     -6.63e-09\npolygon 32 (hole)       35 -1.38385e+02     -2.09e-07\npolygon 33 (hole)       23 -1.99656e+01     -3.01e-08\npolygon 34              71  5.63061e+03      8.50e-06\npolygon 35              10  1.99717e+02      3.01e-07\nenclosing rectangle: [2667.54, 50271.73] x [21448.47, 50256.33] units\n                     (47600 x 28810 units)\nWindow area = 662624000 square units\nFraction of frame area: 0.483\n```\n\n\n:::\n:::\n\n\nCombine `trip_dest_ppp` and `trip_origin_ppp` to `sg_owin`\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrip_originSG_ppp <- trip_origin_ppp[sg_owin]\ntrip_destSG_ppp <- trip_dest_ppp[sg_owin]\n```\n:::\n\n\n## 3.2 Calculation\n\nAuto bandwidth with different kernel function for `trip_origin`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkde_trip_originSG_G <- density(trip_originSG_ppp,\n                                sigma = bw.diggle,\n                                edge = TRUE,\n                                kernel = \"gaussian\")\nplot(kde_trip_originSG_G)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n\n```{.r .cell-code}\nkde_trip_originSG_Q <- density(trip_originSG_ppp,\n                                sigma = bw.diggle,\n                                edge = TRUE,\n                                kernel = \"quartic\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in density.ppp(trip_originSG_ppp, sigma = bw.diggle, edge = TRUE, :\nBandwidth selection will be based on Gaussian kernel\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(kde_trip_originSG_Q)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-27-2.png){width=672}\n:::\n:::\n\nMost number of trips begin at the east side of Singapore\n\n# 4 Network-constrained Kernel Density Estimation\n\n\n",
    "supporting": [
      "Take-home_Ex01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}